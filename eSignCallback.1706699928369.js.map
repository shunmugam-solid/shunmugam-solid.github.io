{"version":3,"file":"eSignCallback.1706699928369.js","mappings":"uJAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACA,EAAG,MAAM,CAACE,YAAY,oKAAoK,CAACF,EAAG,MAAM,CAACE,YAAY,yBAAyB,CAACF,EAAG,kBAAkB,CAACG,MAAM,CAAC,iBAAiB,YAAY,UAAY,2BAA2B,MAAO,KAAQH,EAAG,IAAI,CAACE,YAAY,SAAS,CAACN,EAAIQ,GAAG,IAAIR,EAAIS,GAAGT,EAAIU,GAAG,wBAAwB,OAAON,EAAG,MAAM,CAACE,YAAY,kCAAkC,CAACF,EAAG,YAAY,CAACE,YAAY,8CAA8CC,MAAM,CAAC,UAAYP,EAAIW,oBAAoB,KAAO,WAAWC,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOb,EAAIc,aAAY,EAAM,IAAI,CAACd,EAAIQ,GAAG,IAAIR,EAAIS,GAAGT,EAAIU,GAAG,kBAAkB,QAAQ,IAAI,MAAM,EACn1BK,EAAkB,G,0DCmCtB,MAAMC,EAAc,EAEpB,OACAC,OAAAA,CAAAA,EAAAA,GACAC,WAAAA,CACAC,gBAAAA,EAAAA,GAEAC,UACA,IACA,0DACA,2CACA,+CACA,UACAC,EAAAA,EAAAA,IAAAA,GACAC,EAAAA,WAAAA,IAAAA,EAAAA,GACAA,EAAAA,WAAAA,mBAAAA,MAAAA,KAEA,sBACA,yBACA,iDACA,wBAEA,oBACAC,OAAAA,eAAAA,WAAAA,oBACAA,OAAAA,eAAAA,WAAAA,WACAA,OAAAA,eAAAA,WAAAA,cAAAA,KAGA,wBAIA,CAFA,MACA,wBACA,CACA,EACAC,SAAAA,KACA,wCAEAC,OACA,OACAC,WAAAA,EACAf,qBAAAA,EAEA,EACAgB,QAAAA,KACA,kCACA,yCACA,2CACA,sEACAC,YAAAA,GACA,0BAEAC,QAAAA,IAAAA,CAAAA,KAAAA,YAAAA,KAAAA,cAAAA,KAEAC,MAAA,UACA,4BACAC,YAAAA,KACA,wBACA,gCACA,uBACA,oBAEA,+EACA,qCACA,GAPA,GAUA,IAXA,IAaAC,OAAAC,IACA,wBACA,wCAEAC,SAAA,KACAC,EAAAA,OAAAA,GAEA,EACArB,YAAAA,GAAAA,GACA,sBACA,yDACAgB,MAAAM,IACA,uBACA,gBACA,GACAL,YAAAA,KACA,mBACA,qBACA,IACA,IACAC,OAAAC,IACA,+CACAF,YAAAA,KACA,qBACA,IACA,IAEA,qBACA,4BAEA,EACAM,WACA,iCACA,YACA,0BACA,qBACAP,MAAA,KACAC,YAAAA,KACA,2CACA,EAFA,IAIAC,OAAAC,IACAK,QAAAA,IAAAA,GACA,2BAEAJ,SAAA,KACAC,EAAAA,OAAAA,GAEA,CACA,ICzJ6S,I,UCOzSI,GAAY,OACd,EACAxC,EACAgB,GACA,EACA,KACA,KACA,MAIF,EAAewB,EAAiB,O","sources":["webpack://Solid/./src/modules/kyb/views/EsignCallback.vue?691d","webpack://Solid/src/modules/kyb/views/EsignCallback.vue","webpack://Solid/./src/modules/kyb/views/EsignCallback.vue?3fb2","webpack://Solid/./src/modules/kyb/views/EsignCallback.vue"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"\\n      widgetContainer widgetContainer--center\\n      bg-white\\n      widgetContainer--full-screen\\n      verifying\\n      appStatus appStatus--verifying\\n    \"},[_c('div',{staticClass:\"widgetContainer__body\"},[_c('LottieAnimation',{attrs:{\"animation-name\":\"searching\",\"reference\":\"business-status-review-1\",\"loop\":true}}),_c('p',{staticClass:\"title\"},[_vm._v(\" \"+_vm._s(_vm.$t('esign_callbackTitle'))+\" \")]),_c('div',{staticClass:\"widgetContainer__footer--fixed\"},[_c('el-button',{staticClass:\"welcome__get-started el-button__brand brand\",attrs:{\"disabled\":!_vm.isRetryCountReached,\"type\":\"primary\"},on:{\"click\":function($event){return _vm.checkStatus(false)}}},[_vm._v(\" \"+_vm._s(_vm.$t('esign_ctaText'))+\" \")])],1)],1)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <div\n      class=\"\n        widgetContainer widgetContainer--center\n        bg-white\n        widgetContainer--full-screen\n        verifying\n        appStatus appStatus--verifying\n      \">\n      <div class=\"widgetContainer__body\">\n        <LottieAnimation animation-name=\"searching\" reference=\"business-status-review-1\" :loop=\"true\" />\n        <p class=\"title\">\n          {{ $t('esign_callbackTitle') }}\n        </p>\n        <div class=\"widgetContainer__footer--fixed\">\n          <el-button\n            :disabled=\"!isRetryCountReached\"\n            type=\"primary\"\n            class=\"welcome__get-started el-button__brand brand\"\n            @click=\"checkStatus(false)\">\n            {{ $t('esign_ctaText') }}\n          </el-button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport { mapActions, mapGetters, mapMutations } from 'vuex';\nimport loginMixins from '@m/user/mixins/login';\nimport { setEnv } from '@/utils/env';\nimport LottieAnimation from '@/components/LottieAnimation.vue';\nimport Vue from 'vue';\nimport auth0 from '@/plugins/auth0';\n\nconst RETRY_COUNT = 3;\n\nexport default {\n  mixins: [loginMixins],\n  components: {\n    LottieAnimation\n  },\n  created() {\n    try {\n      const tokens = window.sessionStorage.getItem('user_auth_tokens');\n      const appEnv = window.sessionStorage.getItem('app_env');\n      const businessId = window.sessionStorage.getItem('business_id');\n      if(tokens && appEnv && businessId) {\n        setEnv(appEnv);\n        Vue.use(auth0);\n        Vue.getAuth0Instance().then(() => {\n\n          const tokenJson = JSON.parse(tokens);\n          this.setUserAuthToken(tokenJson);\n          this.$http.defaults.headers.common.AUTHORIZATION =\n                'Bearer ' + tokenJson.accessToken;\n\n          this.verifyToken(businessId);\n          window.sessionStorage.removeItem('user_auth_tokens');\n          window.sessionStorage.removeItem('app_env');\n          window.sessionStorage.removeItem('business_id');\n        })\n      } else {\n        this.goToWelcomeScreen();\n      }\n    } catch {\n      this.goToWelcomeScreen();\n    }\n  },\n  computed: {\n    ...mapGetters('kyb', ['getSelectedBusiness']),\n  },\n  data() {\n    return {\n      retryCount: 0,\n      isRetryCountReached: false\n    }\n  },\n  methods: {\n    ...mapActions('user', ['getPerson']),\n    ...mapMutations('user', ['setUserAuthToken']),\n    ...mapMutations('kyb', ['setSelectedBusiness']),\n    ...mapActions('kyb', ['submitKyb', 'fetchBusiness', 'getOwnershipDisclosure']),\n    verifyToken(businessId) {\n      const loader = this.showLoader();\n\n      Promise.all([this.getPerson(), this.fetchBusiness(businessId)])\n        // eslint-disable-next-line no-unused-vars\n        .then(([_, business]) => {\n          this.setSelectedBusiness(business);\n          setTimeout(() => {\n            this.loginSuccess(() => {\n              const event = this.$route.query.event;\n              if(event === 'signing_complete') {\n                this.checkStatus();\n              } else {\n                this.apiErrorMessage('Unable to complete document signing, please try again.');\n                this.$router.push('/kyb/ownersList');\n              }\n            });\n            \n          }, 2000);\n        })\n        .catch((e) => {\n          this.apiErrorMessage(e);\n          this.$router.push('/kyb/ownersList');\n        })\n        .finally(() => {\n          loader.close();\n        });\n    },\n    checkStatus(isRetryCall = true) {\n      if ((this.retryCount < RETRY_COUNT || !isRetryCall)) {\n        this.getOwnershipDisclosure(this.getSelectedBusiness.id)\n          .then((res) => {\n            if(res.status === 'completed') {\n              this.startKYB();\n            } else if(isRetryCall) {\n              setTimeout(() => {\n                this.retryCount += 1;\n                this.checkStatus();\n              }, 3000);\n            }\n          }).catch((e) => {\n            if (e.code === 'EC_BUSINESS_AGREEMENT_NOT_FOUND' && isRetryCall) {\n              setTimeout(() => {\n                this.retryCount += 1;\n              }, 3000);\n            }\n          });\n      } else if(this.retryCount >= RETRY_COUNT) {\n        this.isRetryCountReached = true\n      }\n    },\n    startKYB() {\n      const business = this.getSelectedBusiness;\n      if (business && business.id) {\n        const loader = this.showLoader();\n        this.submitKyb(business.id)\n          .then(() => {\n            setTimeout(() => {\n              this.$router.push('/kyb/businessStatus');\n            }, 0);\n          })\n          .catch((e) => {\n            console.log(e);\n            this.apiErrorMessage(e);\n          })\n          .finally(() => {\n            loader.close();\n          });\n      }\n    }\n  }\n}\n</script>","import mod from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./EsignCallback.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./EsignCallback.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./EsignCallback.vue?vue&type=template&id=77b68f1f&\"\nimport script from \"./EsignCallback.vue?vue&type=script&lang=js&\"\nexport * from \"./EsignCallback.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","_v","_s","$t","isRetryCountReached","on","$event","checkStatus","staticRenderFns","RETRY_COUNT","mixins","components","LottieAnimation","created","setEnv","Vue","window","computed","data","retryCount","methods","verifyToken","Promise","then","setTimeout","catch","e","finally","loader","res","startKYB","console","component"],"sourceRoot":""}